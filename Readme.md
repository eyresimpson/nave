## Nave Ambassador（Runner）

- Json文件执行
- 可配置化
- 网络控制器
- 可扩展插件

## 执行原理

Nave可以解析Json文件，并根据规范，开启两种不同类型的业务流：

- 接口业务流（接口）
- 定时业务流（定时任务）

当满足业务流的条件触发时，Nave会通过协程的方式调用流，此处以接口（接口业务流）为例：

1. 【Engine】加载配置文件（系统配置文件）
2. 【Engine】开启系统API监听（默认不开启）
3. 【Engine】加载插件（在当前目录下的mods或plugins目录中搜索）
4. 【Engine】根据配置文件或默认值加载流水线（协程）
5. 【AssemblyLine】检测流水线类型（服务、定时任务）
    - 服务
        - 开启Serve
        - 监听指定的Path
    - 定时任务
        - 开启定时任务
6. 【AssemblyLine】触发流水线
7. 【Worker】执行指定的Steps（Worker - Run方法）
8. 【Worker】根据worker的类型，执行不同的操作（业务、逻辑）
    - 业务
        - 转换参数表达式（如果是服务流）
        - 调用Plugins Run执行具体操作
    - 逻辑
        - 判断
            - 切分三元表达式（判断由三元表达式实现）
            - 将变量表达式转换为具体的值
            - 执行逻辑表达式，获取执行结构
            - 根据执行结构，运行不同的分支
        - 循环
            - 值循环
            - 条件循环
            - 次循环

## 数据结构

### 流水线

蓝图一般是一个独立的文件，其中保存了流水线具体的执行策略，一个蓝图即是一条流水线

蓝图的类型并不固定，支持 json、xml、yml和数据库表类型，只需要符合Nave蓝图规范，即可由Nave转换为统一的蓝图结构体

## 内容

- 项目：Pro
- 业务：Bus
- 步骤：Ste
- 操作：Opt

通过Go语言编写的可执行器，用于执行Artist产生的Json文件

- 网络监听
    - Http Restful
    - Socket
- 数据库
    - MySQL
    - SQLServer
    - Oracle
- 文件
    - 基础文件操作
    - 文件监控
-

#### 表达式

- 参数表达式：主要用请求类流，用于将请求参数转换为执行参数
- 变量表达式：获取流中定义的变量
- 条件表达式：执行条件
- 求值表达式：获取表达式中的值，可引用变量表达式

函数执行

## Nave Artist

Nava设计器，用于设计业务流程，通过Electron + Vue3 + Typescript实现

- 流设计
- 业务模拟
- 端口
- 代码生成器

## Nave Watchman

Nave 管理监控,Go + Vue3 + Typescript编写

版本计划：

### 0.1.0

> 2023年9月1日

- ✅支持运行json Exec
- ✅支持基础操作
    - ✅打印字符串
    - ✅记录日志
- ✅基础表达式
    - ✅参数表达式
    - ✅条件表达式
- ✅支持http相关操作
    - ✅监听Http端口(Get)
    - ✅根据不同的路由执行不同的操作
- ✅支持基础逻辑操作
    - ✅条件判断
- 🤔支持基础MySQL操作
    - 🤔链接到数据库
    - 🤔执行SQL语句
- ⚠️变量问题

### 0.2.0

> 2023年10月1日

- 完成基础Nave Artist的设计与开发
    - 基础设计器界面
    - 输出Json文件
- 引入项目、流水线、执行者的概念
- 底层操作执行改为反射方式
- Http监听完善
    - Post
        - Json
        - Form
        - File
    - Put
    - Delete
- 支持更多逻辑操作
    - 条件循环
    - 次数循环
    - 内容循环
- 核心引擎改为蓝图驱动

### 0.3.0

> 2023年11月1日

- 支持操作系统操作
- 支持文件系统操作
- 完整支持MySQL
- 支持基础SQLServer
- 支持基础Oracle
- 改为标准EL表达式
- 整体架构整理优化

### 0.4.0

> 2023年12月1日

- 支持Yml Exec
- 支持Xml Exec
- 项目安全策略升级

### 1.0.0

> 2024年1月1日

- 完整支持SQLServer
- 完整支持Oracle
- 支持插件系统
- 支持数据库Exec
- 初步支持集群化
- 完成Nave Watchman的设计与开发
- 主版本改为年份系列

## 更新规则

> version 1.2.3
> 注意，0.x.x版本所有基础版本也可能存在不兼容的情况

1: 大版本，大版本之间Exec可能存在不兼容情况，需要使用升级器进行升级
2：基础版本：代表新增了特别的功能或者修复了严重的漏洞
3：小版本：代表修复了Bug，这种情况下会添加小版本号